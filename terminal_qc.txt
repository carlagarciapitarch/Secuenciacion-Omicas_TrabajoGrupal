(base) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ conda create -n act_grupal_omicas -c bioconda -c conda-forge -c defaults -c r fastqc fastp multiqc bwa samtools=1.19

(base) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ conda activate act_grupal_omicas

(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ 

# Creamos las carpetas que necesitamos para el QC

(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ mkdir -p Quality/Raw Quality/Filtered Trimmed

# Realizamos el control de calidad con FastQC:
(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ fastqc *fastq.gz -o Quality/Raw/

# El documento que nos interesa es el HTML generado. Inevitablemente al final de las lecturas la calidad baja. Debemos tener igual o mayor a 30. Los R2 suelen ser de peor calidad que los R1. En todas las secuencias la calidad por base es muy buena, el unico problema es el contenido de GC que en algunos casos no sigue una curva normal, lo que podría indicar que hay contaminacion por adaptadores. Como en general está bien vamos a realizar un preprocesamiento, pero uno general, nada sofisticado. Vamos a usar fastp para ello.

# Ejecutamos el filtrado de secuencias por calidad y longitud. Solo vamos a ejecutar lo de los adaptadores, no hace falta cortar al principio y final porque las secuencias tienen mucha calidad siempre, no hay este descenso de calidad habitual, posiblemente porque se trate de datos simulados para la actividad. 

# Lo vamos a realizar mediante un bucle porque son muchas muestras, en este caso habría que incluir todos los nombres de las muestras en un fichero, por ejemplo muestras.txt, un identificador por línea y ejecutar el bucle:

(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ ls *fastq.gz | cut -d _ -f 1 | sort -u > muestras.txt

(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ for i in $(cat muestras.txt); do fastp --in1 $i*R1* --in2 $i*R2* --out1 Trimmed/$i"_R1_filtered.fastq.gz" --out2 Trimmed/$i"_R2_filtered.fastq.gz" --detect_adapter_for_pe --cut_front --cut_tail --cut_window_size 12 --cut_mean_quality 30 --length_required 35 --json Trimmed/$i.json --html Trimmed/$i.html --thread 32; done


# Ejecutamos de nuevo un segundo control de calidad para corroborar que hemos realizado correctamente el filtrado

(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ fastqc Trimmed/*fastq.gz -o Quality/Filtered/


# Podemos generar un informe resumen de los pasos que hemos realizado con multiqc. Coge todos los html que esten en esa carpeta y genera un report unico.

(act_grupal_omicas) carla@carla-IdeaPad-Slim-3-15ABR8:~/Documentos/MasterBioinformatica/1Q/Secuenciacion_Omicas/Actividades/Actividad grupal/Resolucion_Act_Grupal$ multiqc .


